from io import BytesIO  # Importe BytesIO do m√≥dulo io
from pypdf import PdfReader
import requests
import pdfplumber
import os
import pytesseract
from PIL import Image
import csv

url = ["https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/abrantes/3155-abrantes/file"]
#url = ['https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/abrantes/3155-abrantes/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/agueda/2947-agueda/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/guarda/aguiar-da-beira/3125-aguiar-da-beira/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/evora/alandroal/2953-alandroal/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/albergaria-a-velha/2948-albergaria-a-velha/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/faro/albufeira/3094-albufeira/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/setubal/alcacer-do-sal/3123-alcacer-do-sal/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/alcanena/3159-alcanena/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/alcobaca/3156-alcobaca/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/setubal/alcochete/3121-alcochete/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/faro/alcoutim/3095-alcoutim/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/alenquer/3186-alenquer/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/alentejo/NUTS II - Alentejo.pdf/3296-alentejo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/alentejo/alentejo-central/3298-alentejo-central/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/alentejo/alentejo-litoral/3301-alentejo-litoral/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braganca/alfandega-da-fe/3037-alfandega-da-fe/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/algarve/NUTS II - Algarve.pdf/3294-algarve/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/vila-real/alijo/3050-alijo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/faro/aljezur/3097-aljezur/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/aljustrel/2982-aljustrel/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/setubal/almada/3126-almada/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/guarda/almeida/3127-almeida/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/almeirim/3161-almeirim/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/almodovar/2984-almodovar/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/alpiarca/3163-alpiarca/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/portalegre/alter-do-chao/3211-alter-do-chao/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/alentejo/alto-alentejo/3304-alto-alentejo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/norte/alto-minho/3284-alto-minho/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/norte/alto-tamega/3285-alto-tamega/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/alvaiazare/3157-alvaiazare/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/alvito/2985-alvito/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/amadora/3188-amadora/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/porto/amarante/3236-amarante/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braga/amares/3007-amares/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/anadia/2950-anadia/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/regiao-autonoma-dos-acores/angra-do-heroismo/3225-angra-do-heroismo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/ansiao/3158-ansiao/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/viana-do-castelo/arcos-de-valdevez/3096-arcos-de-valdevez/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/lisboa-1/area-metropolitana-de-lisboa/3310-area-metropolitana-de-lisboa/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/norte/area-metropolitana-do-porto/3286-area-metropolitana-do-porto/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/coimbra/arganil/3069-arganil/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/viseu/armamar/2989-armamar/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/arouca/2951-arouca/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/evora/arraiolos/2955-arraiolos/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/portalegre/arronches/3213-arronches/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/arruda-dos-vinhos/3189-arruda-dos-vinhos/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/norte/ave/3287-ave/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/aveiro-1/2952-aveiro/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/portalegre/avis/3214-avis/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/azambuja/3191-azambuja/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/porto/baiao/3238-baiao/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/alentejo/baixo-alentejo/3307-baixo-alentejo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braga/barcelos/3008-barcelos/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/barrancos/2987-barrancos/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/setubal/barreiro/3128-barreiro/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/batalha/3160-batalha/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/centro/beira-baixa/3297-beira-baixa/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/centro/beiras-e-serra-da-estrela/3299-beiras-e-serra-da-estrela/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/beja-1/2988-beja/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/castelo-branco/belmonte/3051-belmonte/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/benavente/3166-benavente/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/bombarral/3162-bombarral/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/evora/borba/2958-borba/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/vila-real/boticas/3053-boticas/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braga/braga-1/3010-braga/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braganca/braganca-1/3038-braganca/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braga/cabeceiras-de-basto/3011-cabeceiras-de-basto/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/cadaval/3192-cadaval/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/caldas-da-rainha/3164-caldas-da-rainha/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/regiao-autonoma-dos-acores/calheta/3229-calheta-1/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/regiao-autonoma-da-madeira/calheta-2/3265-calheta/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/regiao-autonoma-da-madeira/camara-de-lobos/3268-camara-de-lobos/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/viana-do-castelo/caminha/3098-caminha/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/portalegre/campo-maior/3216-campo-maior/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/coimbra/cantanhede/3070-cantanhede/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braganca/carrazeda-de-ansiaes/3039-carrazeda-de-ansiaes/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/viseu/carregal-do-sal/2991-carregal-do-sal/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/santarem/cartaxo/3172-cartaxo/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/lisboa/cascais/3194-cascais/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/leiria/castanheira-de-pera/3165-castanheira-de-pera/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/castelo-branco/castelo-branco-1/3052-castelo-branco/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/aveiro/castelo-de-paiva/2954-castelo-de-paiva/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/portalegre/castelo-de-vide/3217-castelo-de-vide/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/viseu/castro-daire/2993-castro-daire/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/faro/castro-marim/3099-castro-marim/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/beja/castro-verde/2990-castro-verde/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/norte/cavado/3288-cavado/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/guarda/celorico-da-beira/3129-celorico-da-beira/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/distritos-concelhos/braga/celorico-de-basto/3013-celorico-de-basto/file', 'https://www.gee.gov.pt/pt/lista-publicacoes/estatisticas-regionais/nut-ii-nut-iii/centro/NUTS II - Centro.pdf/3295-centro/file']

blabl = 0
space = ["  ","   ","  ","  ","   "]

for link in url:
    response = requests.get(link)
    a = link.split("/")[-2]
    if response.status_code == 200:
        with pdfplumber.open(BytesIO(response.content)) as pdf:
            with open('output.csv', 'w', newline='') as csvfile:
                writer = csv.writer(csvfile)
                
                for i, page in enumerate(pdf.pages):
                    tables = page.extract_tables()
                    for table in tables:
                        for row in table:
                            if blabl == 0:
                                row.append('freguesia')
                                writer.writerow(row)
                                blabl += 1
                            else:
                                row.append(f'{a}')
                                writer.writerow(row)
                        writer.writerow(space)
                            
    else:
        print("Falha ao baixar o PDF")


### fun√ß√£o para pegar as tabelas dos pdf online

# def flares(url:list):
#     kaka = []
#     j = {}
#     for i in url:
#         response = requests.get(i)
#         if response.status_code == 200:
#             with pdfplumber.open(BytesIO(response.content)) as pdf:
#                 for k, page in enumerate(pdf.pages):
#                     tables = page.extract_tables()
#                     for table in tables:
#                         for row in table:
#                             kaka.append(row)
#                         if k not in j:
#                             j[k] = kaka

#                 return j    
#         else:
#             print("Falha ao baixar o PDF")

